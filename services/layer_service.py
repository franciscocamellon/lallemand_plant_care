# -*- coding: utf-8 -*-
"""
/***************************************************************************
 LayerService
                                 A QGIS plugin
 Lallemand - Crop Analysis Environment
 Generated by Plugin Builder: http://g-sherman.github.io/Qgis-Plugin-Builder/
                             -------------------
        begin                : 2023-09-28
        git sha              : $Format:%H$
        copyright            : (C) 2023 by ETG
        email                : etg@email.com
 ***************************************************************************/

/***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
"""
import os
from qgis.core import QgsProject, QgsVectorLayer, QgsLayerTreeGroup, QgsLayerTreeLayer


class LayerService:

    def __init__(self, iface):
        self.iface = iface

    def load_shape_file(self, project, group_name, file_path):

        layer = self.create_vector_layer(self.get_file_name(file_path), file_path)
        # QgsProject.instance().addMapLayer(layer)
        if not layer:
            print("Layer failed to load!")
        #
        # group = root.findGroup(group_name)
        # group.addLayer(layer)
        # self.create_layer_tree_group(project, group_name, layer)
        root = project.instance().layerTreeRoot()
        group = QgsLayerTreeGroup(group_name)
        root.addChildNode(group)
        group.insertChildNode(0, QgsLayerTreeLayer(layer))
        project.layerTreeRoot().addLayer(layer)
        # project.layerTreeRoot().refreshLayer(layer)


    @staticmethod
    def create_vector_layer(layer_name, data_source, crs=None):
        layer = QgsVectorLayer(data_source, layer_name, "ogr")
        if crs is not None:
            layer.setCrs(crs)
        return layer

    @staticmethod
    def create_layer_tree_group(qgs_project, group_name, layer):
        root = qgs_project.instance().layerTreeRoot()
        group = QgsLayerTreeGroup(group_name)
        root.addChildNode(group)
        group.insertChildNode(0, QgsLayerTreeLayer(layer))
        # return group

    @staticmethod
    def get_file_name(file_path):
        return os.path.splitext(os.path.basename(file_path))[0]

    @staticmethod
    def retrieve_group_name(harvester, gps):
        if harvester:
            return 'Harvester points'
        elif gps:
            return 'GPS points'
        else:
            pass
